# -*- mode: python -*-
# WaspSrc build script
# SConstruct file

# I love scones :3
# Very yummy.

# SConstruct â€” equivalent to WaspSrc Makefile

import os
from glob import glob

# Program name
program_name = 'WaspSrc'

# Source files
program_c_srcs = glob('*.c')

# Libraries
program_libraries = ['X11', 'Xext', 'm', 'asound']

# Compiler and linker flags
CFLAGS = ['-Wall', '-m32', '-O2', '-fcommon']
LDFLAGS = ['-m32'] + [f'-l{lib}' for lib in program_libraries]

# Define build environment
env = Environment(
    CC='gcc',
    CFLAGS=CFLAGS,
    LINKFLAGS=LDFLAGS
)

# Build target
program = env.Program(target=program_name, source=program_c_srcs)

# Custom build aliases (equivalent to .PHONY targets)
env.Alias('all', program)
env.Alias('wasp', program)
env.Alias('clean', None, Delete([program_name] + [src.replace('.c', '.o') for src in program_c_srcs]))

# Dependency install aliases (Ubuntu and Arch)
def depinstall_ub(target, source, env):
    os.chmod('../dep_utils/ubuntuinstall.sh', 0o755)
    os.system('../dep_utils/ubuntuinstall.sh')

def depinstall_arch(target, source, env):
    os.chmod('../dep_utils/archinstall.sh', 0o755)
    os.system('../dep_utils/archinstall.sh')

env.Alias('depinstall_ub', None, depinstall_ub)
env.Alias('depinstall_arch', None, depinstall_arch)

# distclean alias (clean + remove intermediates)
def distclean(target, source, env):
    for f in [program_name] + [src.replace('.c', '.o') for src in program_c_srcs]:
        if os.path.exists(f):
            os.remove(f)

env.Alias('distclean', None, distclean)
